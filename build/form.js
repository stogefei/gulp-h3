angular.module("formApp",["ionic","formApp.controllers","formApp.services","formApp.directives","ion-datetime-picker","ngIOS9UIWebViewPatch","ngCordova","oc.lazyLoad"]).run(function(e,t,n,a,o,r,i,s,c,l,d,u){e.ready(function(){u.scrolling.jsScrolling(!0),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.cordova&&window.cordova.InAppBrowser&&(window.open=window.cordova.InAppBrowser.open),window.StatusBar&&StatusBar.styleDefault(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.screenorientation&&window.cordova.plugins.screenorientation.setOrientation("portrait"),$(document).keydown(function(e){13==e.keyCode&&"textarea"!=e.currentTarget.activeElement.type&&(e.stopPropagation(),e.preventDefault())})}),e.registerBackButtonAction(function(e){},100),"en_us"==(window.localStorage.getItem("H3.Language")||"zh_cn")?(o.weekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],o.months=["Jan","Fed","Mar","Apr","May","Jun","Jul","Aug","Sept","Otc","Nov","Dec"],o.ok="OK",o.cancel="Clear"):(o.weekdays=["日","一","二","三","四","五","六"],o.months=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],o.ok="确定",o.cancel="清空");var h="<ion-modal-view class='bpm-mobile-select'><ion-header-bar class='bar-dark'><h1 class='title'>{{header}}</h1><button class='button button-clear button-icon ion-close-circled item-right' ng-click='modal.hide()'></button></ion-header-bar><ion-header-bar class='bar-subheader item-input-inset'><label class='item-input-wrapper'><i class='icon ion-ios-search placeholder-icon'></i><input type='search' placeholder='Search' ng-model='searchText'></label></ion-header-bar><ion-content><ion-list>",p="</ion-list></ion-content></ion-modal-view>",m="<style>.bpm-mobile-select {top: 190px;}.bpm-mobile-select ion-list div.list{padding-bottom:190px;}.bpm-mobile-select ion-list div.list label div.item-content{padding-bottom: 10px;padding-top: 10px;}</style>";d.put("checkbox_autocomplete.html",h+"<ion-checkbox ng-repeat='item in CheckListDisplay| filter:searchText'ng-model='item.checked'ng-checked='item.checked' ng-click='clickCheckList()'>{{item.text}}</ion-checkbox>"+m+p),d.put("radio_autocomplete.html",h+"<ion-radio ng-repeat='item in RadioListDisplay | filter:searchText'ng-model='RadioListValue'ng-value='item.Value'ng-click='clickRadio(item.Value,item.Text)'>{{item.Text}}</ion-radio>"+m+p)}).config(function(e,t,n){n.platform.android.tabs.style("standard"),n.platform.android.tabs.position("bottom"),n.platform.android.navBar.alignTitle("center"),n.backButton.previousTitleText(!1).text("").icon("ion-android-arrow-back"),n.platform.ios.views.transition("ios"),n.platform.android.views.transition("android"),e.state("form",{url:"/form",abstract:!0,templateUrl:function(){return"Mobile/form/templates/empty.html?v="+(new Date).getTime()},controller:"mainCtrl",params:{dataField:"",loadUrl:"",loadOptions:"",initUsers:null,isMutiple:!1,options:null}}).state("form.detail",{url:"/detail",views:{"form-detail":{templateUrl:function(){return"Mobile/form/templates/formDetail.html?v="+(new Date).getTime()},controller:"formSheetCtrl"}}}).state("form.sheetquery",{url:"/sheetquery/:datafield/:rownum/:objectid",views:{"form-detail":{templateUrl:function(){return"Mobile/form/templates/sheetQuery.html?v="+(new Date).getTime()},controller:"sheetQueryCtrl"}}}).state("form.sheetuser",{url:"/sheetuser",views:{"form-detail":{templateUrl:function(){return"Mobile/form/templates/sheetUser.html?v="+(new Date).getTime()},controller:"sheetUserCtrl"}}}).state("form.fetchuser",{url:"/fetchuser",views:{"form-detail":{templateUrl:function(){return"Mobile/form/templates/FetchUser.html?v="+(new Date).getTime()},controller:"fetchUserCtrl"}}}).state("form.instancestate",{url:"/instancestate/:Mode/:InstanceID/:WorkflowCode/:WorkflowVersion",views:{"form-detail":{templateUrl:function(){return"Mobile/form/templates/instanceState.html?v="+(new Date).getTime()},controller:"instanceStateCtrl"}},resolve:{deps:["$ocLazyLoad",function(e){return console.log("_PORTALROOT_GLOBAL >>> "+_PORTALROOT_GLOBAL),e.load(["WFRes/assets/stylesheets/sheet.css?v=201802091435","WFRes/_Content/designer/css/designer.css?v=201802091435","Mobile/Scroll/iscroll-zoom.js?v=201802091435","WFRes/_Scripts/designer/Activity.js?v=201802091435","WFRes/_Scripts/designer/ActivityDrag.js?v=201802091435","WFRes/_Scripts/designer/ActivityModel.js?v=201802091435","WFRes/_Scripts/designer/Line.js?v=201802091435","WFRes/_Scripts/designer/Workflow.js?v=201802091435","WFRes/_Scripts/designer/WorkflowDocument.js?v=201802091435"]).then(function(){return e.load(["WFRes/_Scripts/jquery/jquery.lang.js?v=201802091435","WFRes/_Scripts/designer/misc.js?v=201802091435","WFRes/_Scripts/designer/MobileLoader.js?v=201802091435"])})}]}}).state("form.downLoadFile",{url:"downLoadFile/:url/:extension",cache:!1,views:{"form-detail":{templateUrl:function(){return"Mobile/form/templates/downLoadFile.html?v="+(new Date).getTime()},controller:"downLoadFileCtrl"}}}),t.otherwise("/form/detail")});var formModule=angular.module("formApp.controllers",[]).controller("mainCtrl",function(o,r,i,e,t,a,s){o.dingMobile={isDingMobile:!1,dingHeaderClass:"has-header",dingSubHeaderClass:"has-header has-subheader",hideHeader:!1},r.SetDingDingLeft=function(){dd&&dd.biz.navigation.setLeft({control:!0,android:!0,text:"返回",onSuccess:function(e){dd.biz.navigation.goBack({})},onFail:function(e){dd.biz.navigation.goBack({})}})};var n=window.localStorage.getItem("H3.Language")||"zh_cn";r.sheetSettingLanguage="zh_cn"!=n&&"null"!=n,r.GetDingMobile=function(){var e="",t="",n=new RegExp("(^|&)loginfrom=([^&]*)(&|$)"),a=top.window.location.search.substr(1).match(n);null!=a&&(e=unescape(a[2])),n=new RegExp("(^|&)source=([^&]*)(&|$)"),null!=(a=top.window.location.search.substr(1).match(n))&&(t=unescape(a[2])),o.source=t,"dingtalk"==e&&dd&&dd.version&&(o.dingMobile.isDingMobile=!0,o.dingMobile.dingHeaderClass="",o.dingMobile.dingSubHeaderClass="has-subheader",o.dingMobile.hideHeader=!0,r.SetDingDingLeft(),document.addEventListener("backbutton",function(){"form.detail"==i.current.name&&"dingtalk"==e&&dd&&dd.biz.navigation.goBack({})})),dd&&dd.version?(o.dingMobile.isDingMobile=!0,o.dingMobile.dingHeaderClass="",o.dingMobile.dingSubHeaderClass="has-subheader",o.dingMobile.hideHeader=!0,dd.biz.navigation.setLeft({control:!0,android:!0,text:"返回",onSuccess:function(e){dd.biz.navigation.goBack({})},onFail:function(e){dd.biz.navigation.goBack({})}}),o.loginfrom="dingtalk"):"app"==e?o.loginfrom="app":"wechat"==e&&(o.loginfrom="wechat")},r.GetDingMobile(),r.SetDingDingHeader=function(e){console.log(e,"title----------"),dd&&dd.biz.navigation.setTitle({title:e,onSuccess:function(e){},onFail:function(e){alert(e)}})},window.alert=function(e,t){if(256<=e.length&&(e=e.substr(0,256)+"..."),t)a.show({cssClass:"bpm-sheet-confirm",template:'<span class="bpm-sheet-confirm">'+e+"<span>",buttons:[{text:"确定",type:"button-clear",onTap:function(e){t()}}]});else{var n=a.show({cssClass:"bpm-sheet-alert",template:'<span class="">'+e+"<span>"});s(function(){n.close()},1500)}},o.orgIndex=window.history.length}).controller("formSheetCtrl",function(n,r,a,e,t,o,i,s,c,l,d,u,h,p,m,f,g,S,v,I,b,U){var w=document.getElementById("content-wrapper").childNodes;$("#mobile-content").find("div.scroll").prepend(w),$(w).css("overflow","hidden"),r.portalroot=_PORTALROOT_GLOBAL,r.instanceInfo={},r.showMoreInfo=!1,r.showHide=function(){r.showMoreInfo=!r.showMoreInfo,h.resize(),r.showMoreInfo&&h.scrollBottom()},r.getRandom=function(){return Math.floor(4*Math.random())},r.randomNumbers=[];for(var y=0;y<5;y++)r.randomNumbers.push(r.getRandom());$("div[id*=sheetContent]:first").remove(),r.showCirculate=!0,r.showCirculateHide=function(){r.showCirculate=!r.showCirculate},$("div.row").each(function(){$(this).removeClass("row").addClass("list");var c=$(this),l=$(this).children().length,d=$(this).clone().empty();$(this).children().each(function(e,t){var n=$(this).attr("class"),a=e%2==0,o=n.lastIndexOf("-"),r=n.substring(0,o+1),i=a?r+"2":r+"10";if(!(-1<n.indexOf("col-")))return!0;var s=n.split(" ");for(x in s)if(-1<s[x].indexOf("col-")){$(this).removeClass(s[x]);break}$(this).addClass(i),d.append($(this)),a?a&&l-1==e&&(c.before(d),d=d.clone().empty()):(c.before(d),d=d.clone().empty())}),c.remove()}),$.MvcSheetUI.IonicFramework={$rootScope:n,$scope:r,$state:a,$timeout:e,$compile:t,$ionicActionSheet:p,$ionicScrollDelegate:h,$ionicPosition:b,$compile:t,$ionicPopup:i,$ionicModal:f,$ionicPlatform:s,$ionicLoading:U,fcommonJS:g,$ionicPopover:S},$.MvcSheet.Init(function(){try{var e=$.MvcSheetUI.SheetInfo.BizObject.DataItems.Sheet__DisplayName.V;n.InstanceId=$.MvcSheetUI.SheetInfo.InstanceId,n.SheetMode=$.MvcSheetUI.SheetInfo.SheetMode,n.WorkflowCode=$.MvcSheetUI.SheetInfo.WorkflowCode,n.WorkflowVersion=$.MvcSheetUI.SheetInfo.WorkflowVersion,n.InstanceTitle=e,n.names={Back:SheetLanguages.Current.Back,Spread:SheetLanguages.Current.Spread,Retract:SheetLanguages.Current.Retract,WorkflowCharts:SheetLanguages.Current.WorkflowCharts,Close:SheetLanguages.Current.Close,OK:SheetLanguages.Current.OK,SelectAll:SheetLanguages.Current.SelectAll,UnselectAll:SheetLanguages.Current.UnselectAll,Search:SheetLanguages.Current.Search,Day:SheetLanguages.Current.Day,Hour:SheetLanguages.Current.Hour,Minute:SheetLanguages.Current.Minute,Second:SheetLanguages.Current.Second,State:SheetLanguages.Current.State,SheetUser:SheetLanguages.Current.SheetUser,Approve:SheetLanguages.Current.Approver,Waiting:SheetLanguages.Current.Waiting,Confirm:SheetLanguages.Current.Confirm,Cancel:SheetLanguages.Current.Cancel,PleaseSelect:SheetLanguages.Current.PleaseSelect,Query:SheetLanguages.Current.Query,AssociatedSheet:SheetLanguages.Current.AssociatedSheet,Reset:SheetLanguages.Current.Reset,NoMoreData:SheetLanguages.Current.NoMoreData,States:SheetLanguages.Current.States},$("#masterContent_divContent .list>div.item").addClass("hasBorderBottom"),$(".attachment.item").removeClass("hasBorderBottom"),$(".slider-slides .item").removeClass("hasBorderBottom"),$(".SheetGridView").addClass("hasBorderBottom"),$(".SignaturePanel").addClass("hasBorderBottom"),$(".InputPanel").addClass("hasBorderBottom"),v.get("Mobile/LoadInstanceState",{instanceID:n.InstanceId}).then(function(e){if(200==e.code){var t=e.data;r.instanceInfo.BaseInfo=t.baseInfo,3<t.baseInfo.Approvers.length?r.instanceInfo.BaseInfo.Approvers=t.baseInfo.Approvers.slice(0,3).join(",")+"...":r.instanceInfo.BaseInfo.Approvers=t.baseInfo.Approvers.join(","),r.instanceInfo.InstanceLogInfo=t.instanceLogInfoList}else r.instanceInfo=!1},function(e){g.showShortTop(e)})}catch(e){}}),r.openFlowChart=function(e){a.go("form.instancestate",{Mode:n.SheetMode,InstanceID:n.InstanceId,WorkflowCode:n.WorkflowCode,WorkflowVersion:n.WorkflowVersion})},r.$on("$ionicView.enter",function(e,t){n.fetchUserSelect&&(n.fetchUserSelect.ClearChoices(),n.fetchUserSelect.SetValue("")),n.dingMobile.isDingMobile&&dd&&(dd.biz.navigation.setRight({show:!1}),dd.biz.navigation.setLeft({control:!0,onSuccess:function(e){"form.detail"==a.current.name?dd.biz.navigation.goBack({}):window.history.back()},onFail:function(e){}}))}),n.$on("sheetUserFinished",function(e,t){if("fetchUserSelectundefined"==t.dataField){var n=t.dataField;if(!(o=r[n]))return;o.ClearChoices(),o.SetValue(t.obj);var a=n;-1<a.indexOf(".")&&(a=a.replace(".","_")),r["sheetUsers"+a]=t.SelectItems}else{var o;n=t.dataField+t.rowNum;(o=r[n]).ClearChoices(),o.SetValue(t.obj)}}),r.delUserItem=function(e,t){var n=r["sheetUsers"+t][e];r["sheetUsers"+t].splice(e,1),-1<t.indexOf("_")&&(t=t.replace("_",".").replace("_",".").replace(".","_")),r[t].RemoveChoice(n.id)},r.ClosePage=function(){n.dingMobile.isDingMobile?window.history.back():"undefined"!=typeof WeixinJSBridge?"message"==n.source?WeixinJSBridge.call("closeWindow"):window.history.back():window.cordova?window.open($.MvcSheetUI.PortalRoot+"/Mobile/index.html/tab.home","_self"):window.history.back()}}).controller("sheetUserCtrl",function(n,i,e,t,a,o,r,s,c,l,d,u){i.sheetUserHandler="SheetUser/LoadOrgTreeNodes",i.SelectFormStructure=!($.MvcSheetUI.sheetUserParams.loadOptions.indexOf("RootUnitID")<0&&$.MvcSheetUI.sheetUserParams.options.UserVisible&&$.MvcSheetUI.sheetUserParams.loadOptions.indexOf("VisibleUnits")<0),i.init=function(){i.UserOUMembers=[],i.Organizations=[],i.deptNav=[],i.showDeptID="",i.CacheData={},i.SelectItems=[],i.checkedstetus=!1,i.searchKey="",i.SearchMode=!1,i.searchedKeys=[],i.searchItems=[],i.searchedItems=[],i.SearchEmp=!1,i.SearchDep=!1,i.searchOver=!1},i.$on("$ionicView.enter",function(e,t){i.sheetUserParams=$.MvcSheetUI.sheetUserParams,console.log(i.sheetUserParams,"scope.sheetUserParams"),i.ShowCurrentDept=i.sheetUserParams.loadOptions.indexOf("RootUnitID")<0&&i.sheetUserParams.options.UserVisible&&i.sheetUserParams.loadOptions.indexOf("VisibleUnits")<0,i.init(),i.SelectItems=d.initItems(i.sheetUserParams.initUsers),i.selectedName=d.getSelectedName(i.SelectItems),i.InitOUMembers(),i.ShowCurrentDept?(i.SelectFormStructure=!1,i.checkedpagestaue(),i.checkedstetus=!0):i.SelectStructure(!0)}),i.InitOUMembers=function(){$.MvcSheetUI.SheetInfo.UserOUMembers=[];var e=$.MvcSheetUI.SheetInfo.DirectParentUnits,t=i.sheetUserParams.loadOptions.replace("&VisibleUnits=","&V="),n="";if(t){var a=t.split("&");for(var o in a)-1!=a[o].indexOf("UserCodes")&&(n=a[o].split("=")[1])}for(var r in e)d.loadData(i.sheetUserHandler+"?IsMobile=true&ParentID="+r+"&o=U&UserCodes="+n,null).then(function(e){var t=$.grep(e,function(e){if("U"==e.ExtendObject.UnitType)return e});$.MvcSheetUI.SheetInfo.UserOUMembers=$.MvcSheetUI.SheetInfo.UserOUMembers.concat(t),i.UserOUMembers=d.sheetUserAdapter($.MvcSheetUI.SheetInfo.UserOUMembers,i.sheetUserParams.selecFlag),p=m=0,i.UserOUMembers=d.checkItems(i.UserOUMembers,i.SelectItems),angular.forEach(i.SelectItems,function(e){"G"==e.type||"O"==e.type?m++:"U"==e.type&&p++}),i.countNumber()})},i.SelectStructure=function(e){i.SelectFormStructure=e;var t=i.sheetUserParams.loadOptions.replace("&VisibleUnits=","&V=");d.loadData(i.sheetUserHandler+"?LoadTree=true&Recursive=true&isMobile=true&"+t,null).then(function(e){window.console.log("querystr"+t),t.indexOf("UserCodes")<0&&(i.showDeptID=e[0].ObjectID,i.deptNav.push({id:e[0].ObjectID,name:e[0].Text,pid:"",index:"0"}))}),i.CacheData[""]?i.getCacheData(""):i.getData("")},i.itemClick=function(e,t){var n=e.clientX/screen.availWidth*100;"U"==t.type||1==t.root||i.SearchMode||t.canSelect&&!(15<n)?i.addItem(e,t):(u.scrollTop(),t.checked=!t.checked,i.deptNav.push({id:t.id,name:t.name,pid:i.showDeptID,index:"1"}),i.showDeptID=t.id,i.CacheData[t.id]?i.getCacheData(t.id):i.getData(t.id))},i.addItem=function(e,t){var n=t;"input"!=e.target.tagName.toLowerCase()&&(t.checked=!t.checked),t.checked?i.sheetUserParams.isMutiple?("U"==t.type?p++:m++,i.countNumber(),i.SelectItems.push(n)):("U"==t.type?p++:m++,i.countNumber(),i.SelectItems=new Array,i.SelectItems.push(n),i.sheetUserFinished()):("U"==t.type?p--:m--,i.countNumber(),i.SelectItems=d.removeItem(i.SelectItems,t)),i.initcheckedStetus(i.Organizations,i.SelectItems.length),i.selectedName=d.getSelectedName(i.SelectItems),i.SelectFormStructure||i.checkedpagestaue()},i.delItem=function(e){var t=i.SelectItems[e];"U"==t.type?p--:m--,i.countNumber(),i.SelectItems.splice(e,1),i.Organizations=d.deleteSelectItem(i.Organizations,i.SelectItems),i.UserOUMembers=d.deleteSelectItem(i.UserOUMembers,i.SelectItems),i.SelectItems=d.removeItem(i.SelectItems,t),i.selectedName=d.getSelectedName(i.SelectItems),i.initcheckedStetus(i.Organizations,i.SelectItems.length)},i.navClick=function(e,t){i.deptNav=i.deptNav.slice(0,t+1),i.CacheData[e]?i.getCacheData(e):i.getData(e),i.showDeptID=e},i.getData=function(n){var e=i.sheetUserParams.loadOptions.replace("&VisibleUnits=","&V=");d.loadData(i.sheetUserHandler+"?ParentID="+n+"&isMobile=true&"+e,null).then(function(e){if(i.Organizations=d.sheetUserAdapter(e,i.sheetUserParams.selecFlag),console.log(i.Organizations,"$scope.Organizations"),""==n&&i.sheetUserParams.options.RootSelectable&&"true"==i.sheetUserParams.options.OrgUnitVisible&&!i.sheetUserParams.options.UserCodes){var t={Icon:"icon-zuzhitubiao",canSelect:!0,checked:!1,code:i.deptNav[0].id,id:i.deptNav[0].id,name:i.deptNav[0].name,type:"O",root:!0};i.Organizations.unshift(t)}i.checkedstetus=!0,i.Organizations=d.checkItems(i.Organizations,i.SelectItems),i.initcheckedStetus(i.Organizations,i.SelectItems.length),console.log(i.Organizations,"$scope.Organizations"),""==n&&i.sheetUserParams.options.RootSelectable&&"true"==i.sheetUserParams.options.OrgUnitVisible?i.sheetUserParams.options.UserCodes||(i.CacheData[i.deptNav[0].id]=i.Organizations):i.CacheData[n]=i.Organizations})},i.getCacheData=function(e){i.Organizations=i.CacheData[e],i.Organizations=d.checkItems(i.Organizations,i.SelectItems),i.Organizations=d.deleteSelectItem(i.Organizations,i.SelectItems),i.initcheckedStetus(i.Organizations,i.SelectItems.length)},i.sheetUserFinished=function(){var e=d.convertItems(i.SelectItems),t=i.sheetUserParams.options.RowNum;n.$broadcast("sheetUserFinished",{dataField:i.sheetUserParams.dataField,obj:e,rowNum:t,SelectItems:i.SelectItems,scope:i}),i.init(),window.history.back()},i.goToSeach=function(){i.SearchMode=!0},i.$watch("SearchMode",function(e,t){1!=e&&(i.searchItems=[])}),i.addSearchItem=function(e,t){i.addItem(e,t),t.checked&&(i.sheetUserParams.isMutiple||i.closeSearchModal())},i.resetSearchKey=function(e){var t=e.clientX/screen.availWidth*100;""!=i.searchKey&&90<t&&(i.searchKey="")};var h=null;i.doSearch=function(a){if(r.cancel(h),i.SearchEmp=!1,i.SearchDep=!1,i.searchOver=!1,a){var o=a+(i.showDeptID||"");i.searchItems=[],i.searchedKeys.some(function(e){return e===o})?(i.searchedItems.forEach(function(e){if(e.key===o){"U"==e.type&&(i.SearchEmp=!0),"O"!=e.type&&"G"!=e.type||(i.SearchDep=!0);var t=e.name,n=new RegExp(o,"g"),a=t.replace(n,'<b class="userSearched">'+o+"</b>");e.names=a,i.searchItems.push(e)}}),i.searchItems=d.checkItems(i.searchItems,i.SelectItems),i.searchOver=!0):h=r(function(){i.searchedKeys.push(o);var e=i.sheetUserParams.loadOptions.replace("&VisibleUnits=","&V="),t=i.sheetUserHandler+"?"+e,n={ParentID:i.showDeptID||"",SearchKey:encodeURI(a),IsMobile:!0};d.loadData(t,n).then(function(e){d.sheetUserAdapter(e).forEach(function(e){"U"==e.type?i.SearchEmp=!0:"O"!=e.type&&"G"!=e.type||(i.SearchDep=!0),e.key=o;var t=e.name,n=new RegExp(o,"g"),a=t.replace(n,'<b class="userSearched">'+o+"</b>");e.names=a,i.searchedItems.push(e),i.searchItems.push(e)}),i.searchItems=d.checkItems(i.searchItems,i.SelectItems),i.searchOver=!0})},500)}},i.cancel=function(){i.sheetUserFinished()},i.initcheckedStetus=function(e,t){if(0!=i.Organizations.length&&i.SelectFormStructure||(e=i.UserOUMembers),0==t)return!(i.checkedstetus=!0);var n=!0;angular.forEach(e,function(e){n&&(e.canSelect&&e.checked?i.checkedstetus=!1:e.canSelect&&!e.checked&&(i.checkedstetus=!0,n=!1))})},i.checkedpagestaue=function(){if(i.SelectFormStructure||0==i.SelectItems.length)i.SelectFormStructure||0!=i.SelectItems.length||i.checkedObj(i.UserOUMembers,!1);else{var a=0;angular.forEach(i.UserOUMembers,function(t){var n=!0;angular.forEach(i.SelectItems,function(e){n&&(t.id==e.id?(a+=1,t.checked=!0,n=!1):t.checked=!1)})}),a==i.UserOUMembers.length?i.checkedstetus=!1:i.checkedstetus=!0}},i.checkedObj=function(e,n){r(function(){angular.forEach(e,function(e){if(e.canSelect&&n){var t=e;e.checked||(e.checked=!0,i.sheetUserParams.isMutiple?i.SelectItems.push(t):(i.SelectItems=new Array,i.SelectItems.push(t),i.sheetUserFinished()))}else e.canSelect&&!n&&(e.checked=!1,i.SelectItems=d.removeItem(i.SelectItems,e))}),angular.forEach(i.SelectItems,function(e){"G"==e.type||"O"==e.type?m++:p++}),i.countNumber()})};var p=0,m=0;i.checkedAll=function(e){i.checkedstetus?(0!=i.Organizations.length&&i.SelectFormStructure?(m=p=0,i.checkedObj(i.Organizations,!0)):(m=p=0,i.checkedObj(i.UserOUMembers,!0)),i.checkedstetus=!1):(0!=i.Organizations.length&&i.SelectFormStructure?(m=p=0,i.checkedObj(i.Organizations,!1)):(m=p=0,i.checkedObj(i.UserOUMembers,!1)),i.checkedstetus=!0)},i.countNumber=function(){angular.element($("#selectAll").children("span")).remove(),"en_us"==(window.localStorage.getItem("H3.Language")||"zh_cn")?(angular.element($("#selectAll")).append("<span>All(People"+p+",Dept"+m+")</span>"),angular.element($("#confirm")).empty(),angular.element($("#confirm")).append("OK("+p+")")):(angular.element($("#selectAll")).append("<span>全选(已选"+p+"人,部门"+m+")</span>"),angular.element($("#confirm")).empty(),angular.element($("#confirm")).append("确定("+p+")"))},i.goBack=function(){if(u.scrollTop(),i.SearchMode){if($("input[type='search']").blur(),i.SearchMode=!1,i.searchItems=[],i.searchKey="",i.Organizations=d.checkItems(i.Organizations,i.SelectItems),i.UserOUMembers=d.checkItems(i.UserOUMembers,i.SelectItems),i.Organizations=d.deleteSelectItem(i.Organizations,i.SelectItems),i.UserOUMembers=d.deleteSelectItem(i.UserOUMembers,i.SelectItems),i.deptNav&&0<i.deptNav.length){var e=i.deptNav[i.deptNav.length-1].id;i.CacheData[e]?i.getCacheData(e):i.getData(e),i.showDeptID=e}i.SearchMode=!1}else{if(0==i.deptNav.length||1==i.deptNav.length&&!i.ShowCurrentDept)i.sheetUserFinished();else if(i.deptNav=i.deptNav.slice(0,i.deptNav.length-1),0==i.deptNav.length)i.SelectFormStructure=!1,i.checkedpagestaue();else{e=i.deptNav[i.deptNav.length-1].id;i.CacheData[e]?i.getCacheData(e):i.getData(e),i.showDeptID=e}i.countNumber()}}}).controller("sheetQueryCtrl",function(n,l,e,t,a,o,r,i,s){console.log(t),l.choosedObjectId=t.objectid;var d={controlManager:{},dataField:"",rowNum:"",schemaCode:"",queryCode:"",filter:[],inputMappings:"",outputMappings:""};l.OutputMapJson={},l.InputMapJson={},l.viewModel=[],l.displayColumns=[],l.columnNames=[],l.PageSize=10,l.NextPageIndex=0,l.LoadFinished=!1,l.IsBindInputVlues=!1,l.HasBindFilters=!1,l.initParams=function(){d.dataField=t.datafield,d.rowNum=t.rownum,d.controlManager=$.MvcSheetUI.GetElement(d.dataField,d.rowNum).SheetUIManager(),d.controlManager&&(d.schemaCode=d.controlManager.SchemaCode,d.queryCode=d.controlManager.QueryCode,d.controlManager.InputMappings&&(d.inputMappings=d.controlManager.InputMappings),d.controlManager.OutputMappings&&(d.outputMappings=d.controlManager.OutputMappings))},l.SetQueryValue=function(e){for(var t in console.log(e),l.choosedObjectId=e.oldItem.ObjectID,console.log(l.OutputMapJson),l.OutputMapJson)if(t==d.dataField){var n=l.OutputMapJson[t].split(";");if(n&&0<n.length){for(var a=[],o=0;o<n.length;o++)a[o]=e.oldItem[n[o]];console.log(a),d.controlManager.SetValue(a)}else console.log(e.oldItem[l.OutputMapJson[t]]),d.controlManager.SetValue(e.oldItem[l.OutputMapJson[t]]);try{d.controlManager.Validate()}catch(r){}}else{var r=$.MvcSheetUI.GetElement(t,d.rowNum);null!=r&&r.data($.MvcSheetUI.SheetIDKey)&&(r.SheetUIManager().SetValue(e.oldItem[l.OutputMapJson[t]]),r.SheetUIManager().Validate&&r.SheetUIManager().Validate())}},l.GetInputMappings=function(){var e={};if(l.InputMapJson)for(var t in l.InputMapJson)l.InputMapJson[t]&&""!==l.InputMapJson[t].GetValue()&&(e[t]=l.InputMapJson[t].GetValue());return JSON.stringify(e)},l.InputMappingSetting=function(){var e=d.inputMappings.split(",");e||(l.InputMapJson=null);for(var t=0;t<e.length;t++){var n=e[t].split(":"),a=n[0],o=$.MvcSheetUI.GetElement(a,d.rowNum);null!=o&&(l.InputMapJson[n[1]]=o.SheetUIManager())}},l.MappingSetting=function(){for(var e=d.outputMappings.split(","),t=0;t<e.length;t++){var n=e[t].split(":");l.OutputMapJson[n[0]]=n[1]}l.InputMappingSetting()},l.initParams(),l.MappingSetting(),l.GetDisplayName=function(e){return l.columnNames&&l.columnNames[e]||e},l.ControlType={TextBox:0,DropdownList:1,RadioButtonList:2,CheckBoxList:3,RichTextBox:4},l.BindFilter=function(){if(l.HasBindFilters=!0,d.filter&&0!=d.filter.length){l.FilterPanelID=$.MvcSheetUI.NewGuid(),this.FilterPanel=$("#divFilter");for(var e=$("<ul>").addClass("list").appendTo(this.FilterPanel),t=0;t<d.filter.length;t++){var n=d.filter[t];if(n.Visible&&3!=n.FilterType){n.DefaultValue;this.InputMapJson[n.PropertyName];var a=$("<li>").appendTo(e).addClass("item item-input"),o=$("<label for='"+l.FilterPanelID+n.PropertyName+"'>"+l.GetDisplayName(n.PropertyName)+"</label>").addClass("input-label");switch(a.append(o),n.DisplayType){case l.ControlType.DropdownList:var r=$("<select id='"+l.FilterPanelID+n.PropertyName+"' data-property='"+n.PropertyName+"'>");r.append("<option value=''>"+SheetLanguages.Current.All+"</option>");for(var i=n.SelectedValues.split(";"),s=0;s<i.length;s++)""!=i[s]&&r.append("<option value='"+i[s]+"'>"+i[s]+"</option>");r.val(n.DefaultValue),a.append(r);break;case l.ControlType.RadioButtonList:for(i=n.SelectedValues.split(";"),s=0;s<i.length;s++)if(""!=i[s]){var c=$.MvcSheetUI.NewGuid();a.append("<input id='"+c+"' type='radio' name='"+n.PropertyName+"' value='"+i[s]+"'></input>"),a.append("<label for='"+c+"'>"+i[s]+"</label>")}$("input[name='"+n.PropertyName+"'][value='"+n.DefaultValue+"']").attr("checked","checked"),a.append("<br style='clear: both;'></br>");break;case l.ControlType.CheckBoxList:for(i=n.SelectedValues.split(";"),s=0;s<i.length;s++)if(""!=i[s]){c=$.MvcSheetUI.NewGuid();a.append("<input id='"+c+"' type='checkbox' name='"+n.PropertyName+"' value='"+i[s]+"'></input>"),a.append("<label for='"+c+"'>"+i[s]+"</label>")}$("input[name='"+n.PropertyName+"'][value='"+n.DefaultValue+"']").attr("checked","checked"),a.append("<br style='clear: both;'></br>");break;default:a.append("<input type='text' id='"+l.FilterPanelID+n.PropertyName+"' data-property='"+n.PropertyName+"' placeholder='"+l.GetDisplayName(n.PropertyName)+"' autocomplete='off'></input>"),$("#"+n.PropertyName).val(n.DefaultValue)}}}}},l.BindFilterInputValues=function(){l.IsBindInputVlues=!0;for(var e=0;e<d.filter.length;e++){var t=d.filter[e];if(t.Visible&&(3!=t.FilterType&&l.InputMapJson[t.PropertyName]))switch(t.DisplayType){case l.ControlType.RadioButtonList:case l.ControlType.CheckBoxList:l.FilterPanel.find("input[name='"+t.PropertyName+"'][value='"+l.InputMapJson[t.PropertyName].GetValue()+"']").attr("checked","checked");break;default:$("#"+l.FilterPanelID+t.PropertyName).val(l.InputMapJson[t.PropertyName].GetValue())}}},l.GetFilters=function(){for(var e={},t=0;t<d.filter.length;t++){var n=d.filter[t];if(n.Visible&&3!=n.FilterType)switch(n.DisplayType){case l.ControlType.RadioButtonList:case l.ControlType.CheckBoxList:l.FilterPanel.find("input[name='"+n.PropertyName+"']:checked").val()&&(e[n.PropertyName]=$("input[name='"+n.PropertyName+"']:checked").val());break;default:$("#"+l.FilterPanelID+n.PropertyName).val()&&(e[n.PropertyName]=$("#"+this.FilterPanelID+n.PropertyName).val())}}return JSON.stringify(e)},l.getPropertyNameFromData=function(e,t){for(var n in e)if(n.toLocaleLowerCase()==t.toLocaleLowerCase())return n},l.BindData=function(e){if(e){if(e.QuerySetting)for(var t in e.QuerySetting.Columns)1==e.QuerySetting.Columns[t].Visible&&l.displayColumns.push(e.QuerySetting.Columns[t].PropertyName);l.columnNames=e.Columns;l.OutputMapJson[d.dataField];var n=[];for(var t in e.QueryData){var a=0,o=e.QueryData[t],r="";for(var i in o)if(-1<l.displayColumns.indexOf(i)){var s=null==o[i]?"":o[i];r+=l.columnNames[i]+":"+s+"<br/>",a++}n.push({itemName:void 0,summary:r,oldItem:o})}l.LoadFinished=e.LoadFinished,l.viewModel.splice(10*l.NextPageIndex,n.length);a=10*l.NextPageIndex;for(var c=0;a<10*l.NextPageIndex+n.length;a++,c++)l.viewModel.splice(a,0,n[c]);e.LoadFinished||(l.NextPageIndex+=1,l.NetWorkFlag.index=l.NextPageIndex,l.NetWorkFlag.status=!1),d.filter=e.QuerySetting.QueryItems,l.HasBindFilters||l.BindFilter(),l.IsBindInputVlues||l.BindFilterInputValues()}},l.NextPageIndex=0,l.NetWorkFlag={index:0,status:!1},l.viewModel=[],l.LoadQueryData=function(e,t){var n;n=t||l.GetInputMappings(),e||(n={});var a={Action:"GetQuerySettingAndData",SchemaCode:d.schemaCode,QueryCode:d.queryCode,InputMapping:n,PageSize:l.PageSize,NextPageIndex:l.NextPageIndex};0<d.filter.length&&(a.Filters=l.GetFilters()),l.NextPageIndex!=l.NetWorkFlag.index||l.NetWorkFlag.status||(l.NetWorkFlag.status=!0,s.QueryData(a).then(function(e){l.$broadcast("scroll.infiniteScrollComplete"),l.BindData(e)}))},l.conditionLoadQueryData=function(e){l.NextPageIndex=0,l.viewModel=[],l.NetWorkFlag={index:0,status:!1};var n={};$("[data-property]").each(function(e,t){""!==$(t).val()&&(n[$(t).data("property")]=$(t).val())}),console.log(n),l.LoadQueryData(e,n)},l.goBack=function(){window.history.back()},l.reset=function(){d.controlManager.SetValue(""),l.choosedObjectId=""},l.$on("$ionicView.enter",function(e,t){n.dingMobile.isDingMobile&&dd.biz.navigation.setMenu({items:[{id:"1",text:"查询"}],onSuccess:function(e){l.conditionLoadQueryData(!0)}}),l.LoadQueryData(!0)})}).controller("fetchUserCtrl",["$rootScope","$scope","$ionicHistory","$ionicPopup",function(n,r,e,t){r.$on("$ionicView.enter",function(e,t){r.NavBarShow=!0,"dingtalk"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom&&dd&&(r.NavBarShow=!1),($.MvcSheetUI.IonicFramework.$scopeFetchUser=r).Params=$.MvcSheetUI.actionSheetParam,console.log(r.Params,"传阅、转发,征询，协办，加签"),dd&&dd.biz.navigation.setTitle({title:r.Params.title,onSuccess:function(e){},onFail:function(e){}}),$("#fetchUserSelect").html(),r.SheetUser=$("#fetchUserSelect").SheetUser(r.Params.ueroptions),!r.SheetUser&&n.fetchUserSelect&&(r.SheetUser=n.fetchUserSelect),$($(".fetchUserContainer")[0].children).after($(".divContentImg")),r.ActionShow=!0,"Circulate"==r.Params.Action&&(r.ActionShow=!1)}),n.$on("sheetUserFinished",function(e,t){var n=t.dataField,a=r[n];a&&(a.ClearChoices(),a.SetValue(t.obj),r["sheetUsers"+n]=t.SelectItems,r.fetchUserSelectData=t.obj,(angular.isArray(t.obj)&&0<t.obj.length||!angular.isArray(r.fetchUserSelectData))&&(console.log(1),$($(".breadcrumb-wrapper")[1]).append($(".fetchUserContainer"))))}),r.BackPage=function(){r.sheetUsersfetchUserSelectundefined=[],r.SheetUser.ClearChoices(),r.fetchUserSelectData=[],r.Params.commentVaule="",r.Params.title="",window.history.back()},r.doAction=function(){var e=[];if(angular.isUndefined(r.fetchUserSelectData)||angular.isArray(r.fetchUserSelectData)&&0==r.fetchUserSelectData.length)alert(r.Params.Text);else{if(angular.isArray(r.fetchUserSelectData)){var a="";angular.forEach(r.fetchUserSelectData,function(e,t,n){a=""==a?e.Code:a+","+e.Code}),e.push(a)}else{var t=r.fetchUserSelectData.Code;""!=t&&e.push(t)}if(r.Params.Action!=$.MvcSheet.Action_Forward&&e.push(!1),r.Params.Action==$.MvcSheet.Action_Forward||r.Params.Action==$.MvcSheet.Action_Assist||r.Params.Action==$.MvcSheet.Action_Consult){var n=$.trim($("#commentVaule").val())?$.trim($("#commentVaule").val()):"同意";e.push(n)}var o={Action:r.Params.Action,Datas:e};$.MvcSheet.Action(o),window.history.back()}}}]).controller("instanceStateCtrl",["$rootScope","$scope","$stateParams","$http","$ionicScrollDelegate","$ionicHistory","fcommonJS",function(e,t,n,a,o,r,i){t.$on("$ionicView.enter",function(e,t){}),e.dingMobile.isDingMobile,t.scrollHeight={height:document.body.scrollHeight+"px"},t.Mode=n.Mode,t.InstanceID=n.InstanceID,t.WorkflowCode=n.WorkflowCode,t.WorkflowVersion=n.WorkflowVersion,t.closePage=function(){window.history.back()},3==t.Mode?t.IsOriginate=!0:t.IsOriginate=!1,t.init=function(){t.type="base",t.IsOriginate?MobileLoader.ShowWorkflow(t.InstanceID,t.WorkflowCode,t.WorkflowVersion,_PORTALROOT_GLOBAL):MobileLoader.ShowWorkflow(t.InstanceID,"",-1,_PORTALROOT_GLOBAL),i.loadingHide()},t.init()}]).controller("downLoadFileCtrl",["$rootScope","$scope","$state","$location","$http","$stateParams","$ionicHistory","$window","$sce",function(n,a,e,t,o,r,i,s,c){a.$on("$ionicView.enter",function(e,t){a.extension=r.extension,a.url=n.AttachmentUrl,a.url=c.trustAsResourceUrl(n.AttachmentUrl);a.isImg=-1<".jpg,.gif,.jpeg,.png".indexOf(a.extension),a.isTxt=-1<".txt,.doc,.docx,.xlsx,.xls,.ppt,.pptx,.pdf,.html,.csv,.xml".indexOf(a.extension),a.isMp3=-1<".mp3".indexOf(a.extension)})}]);angular.module("formApp.directives",[]).directive("selectLine",function(){return{restrict:"A",link:function(e,t,n){t.bind("click",function(e){this.select()}),t.bind("focus",function(e){this.select()})}}}).directive("bpmSheetUserSelected",function(){return{restrict:"E",replace:!0,scope:{selectUsers:"=",cancelSelected:"="},templateUrl:"Mobile/form/templates/sheetUserSelected.html?v=201802081022"}}),angular.module("formApp.services",[]).service("fcommonJS",function(e,r,a,t,i,o,s,c,n){this.loadingShow=function(e){e=e||("en_us"==(window.localStorage.getItem("H3.Language")||"zh_cn")?'<span class="lodingspan"><ion-spinner icon="ios" class="centerscreen spinner-light "></ion-spinner><span>Data loading…</span></span>':'<span class="lodingspan"><ion-spinner icon="ios" class="centerscreen spinner-light "></ion-spinner><span>数据加载中...</span></span>');a.show({template:e,duration:6e3})},this.showShortMsg=function(e,t,n){a.show({template:'<span class="'+e+'">'+t+"</span>",duration:n,animation:"fade-in",showBackdrop:!1})},this.loadingHide=function(){a.hide()},this.getDateFromJOSN=function(e){e=e.replace(/\/Date\((\d+)\)\//gi,"$1");var t=new Date;return t.setTime(e),t},this.showShortTop=function(e){window.plugins?t.showShortTop(e):a.show({template:e,duration:2e3})},this.checkOnline=function(){return!(window.plugins&&!n.isOnline())||(this.showShortTop("您处理离线状态，请检查网络！"),!1)},this.alert=function(e){i.alert({title:"系统提示",okText:"确认",template:e}).then(function(e){})},this.checkVersion=function(e,t,n){this.checkVersionFromServer(e,t,n,this.upgrade)},this.upgrade=function(e,t){var n="";-1<e.toLowerCase().indexOf("android")&&(n="file:///storage/sdcard0/Download/H3.apk");var a=t.Description,o=this;t.Confirm?this.confirm("系统提示",a,"下次再说","立即升级",function(){o.download(t.Url,n,!0)}):this.download(t.Url,n,!0)},this.download=function(e,t,n){if(t)try{o.download(e,t,{},!0).then(function(e){a.show({template:"已经下载：100%"}),s.open(t,"application/vnd.android.package-archive").then(function(){console.log("open complete")},function(e){console.log("open error->"+e)}),a.hide()},function(e){a.hide(),console.log("download error->"+e)},function(t){c(function(){var e=t.loaded/t.total*100;a.show({template:"已经下载："+Math.floor(e)+"%"}),99<e&&a.hide()})})}catch(e){console.log(e.message)}else console.log("ios upgrade url="+e),window.open(e,"_system","location=yes")},this.checkVersionFromServer=function(e,t,n){var a=this,o=e+"/CheckVersion?callback=JSON_CALLBACK&platform="+t+"&version="+n;r.jsonp(o).success(function(e){a.isNewVersion(n,e.Version)&&a.upgrade(t,e)}).error(function(e){console.log(e.Message),$scope.$broadcast("scroll.refreshComplete")})},this.isNewVersion=function(e,t){for(var n=e.split("."),a=t.split("."),o=0;o<a.length;o++){if(o>=n.length)return!0;if(parseInt(a[o])>parseInt(n[o]))return!0;if(parseInt(a[o])<parseInt(n[o]))return!1}return a.length>n.length},this.confirm=function(e,t,n,a,o,r){i.confirm({title:"检测到新版本",template:t,cancelText:n,okText:a}).then(function(e){e?o.call(this):r.call(this)})},this.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}}).directive("focusOn",function(){return function(e,n,a){e.$on("focusOn",function(e,t){t===a.focusOn&&n[0].focus()})}}).factory("focus",function(t,n){return function(e){n(function(){t.$broadcast("focusOn",e)})}}),formModule.factory("httpService",function(a,o,r){return{get:function(e,t){var n=o.defer();return a({method:"get",url:e,params:t,timeout:3e4}).success(function(e){n.resolve(e)}).error(function(e,t){401===t||403===t?n.reject("请求超时"):n.reject("网络连接出错！")}),n.promise},post:function(e,t){!function(e,t,n){for(var a in t)!t.hasOwnProperty(a)||e.hasOwnProperty(a)&&!n||(e[a]=t[a])}(t,{deskid:r.deskId,userid:r.userId});var n=o.defer();return a({method:"post",url:e,params:t,timeout:3e4}).success(function(e){n.resolve(e)}).error(function(e,t){401===t||403===t?n.reject("链接超时"):n.reject("网络连接出错！")}),n.promise}}}),angular.module("formApp.services").factory("$SheetQuery",["$http","$q","$sce","$ionicActionSheet",function(t,n,e,a){return{QueryData:function(e){var o=n.defer();return t({method:"Get",url:"./BizQueryHandler/BizQueryHandler",params:e}).success(function(e,t,n,a){o.resolve(e)}).error(function(e,t,n,a){o.reject(e)}),o.promise}}}]),formModule.factory("sheetUserService",function(n){return{sheetUser:function(){this.id,this.name,this.checked=!1,this.Icon="",this.ChildrenCount,this.DepartmentName},organization:function(){this.id,this.pid=null,this.deptName,this.isLeaf,this.ChildrenCount,this.unitType,this.checked=!1,this.children=[],this.users=null,this.Icon=""},checkItems:function(e,a){return e&&0!=e.length&&(0==a.length?e.forEach(function(e,t){e.checked=!1}):e.forEach(function(e,t){e.checked=!1;for(var n=0;n<a.length;n++){a[n].id===e.id&&(e.checked=!0)}})),e},deleteSelectItem:function(e,a){return e&&0!=e.length&&0!=e.length&&e.forEach(function(e,t){if(1==e.checked){var n=!0;for(t=0;t<a.length;t++)e.id==a[t].id&&(n=!1);n&&(e.checked=!1)}}),e},initItems:function(e){var a=[];if(e)if(e.constructor==Object){var t={id:e.ObjectID,name:e.Name,type:e.type,UserGender:e.UserGender,UserImageUrl:e.UserImageUrl};a.push(t)}else e.forEach(function(e,t){var n={id:e.ObjectID,name:e.Name,type:e.type,UserGender:e.UserGender,UserImageUrl:e.UserImageUrl};a.push(n)});return a},getDept:function(e,t){var o={},r=function(e,n){var a=!1;e.children&&(e.children.forEach(function(e,t){e.id==n&&(a=!0,o=e)}),a||e.children.forEach(function(e,t){r(e,n)}))};return r(e,t),o},removeItem:function(n,a){return n.forEach(function(e,t){e.id==a.id&&(items=n.splice(t,1))}),n},getSelectedName:function(e){var n="已选：";if(0==e.length)n="";else if(e.length<3)e.forEach(function(e,t){n+=e.name+"、"}),n=n.substring(0,n.length-1);else{for(var t=0;t<2;t++)n+=e[t].name+"、";n=n.substring(0,n.length-1),n+="...等 "+e.length+" 人"}return n},loadData:function(e,t){return n.get(e,t)},sheetOrgAdapter:function(o,e,r){if(!o)return{};var i=new(r=r||this).organization;if(i.id=o.Code,i.pid=e,i.deptName=o.Text,o.ExtendObject&&(i.unitType=o.ExtendObject.UnitType,i.isLeaf=!o.ExtendObject.HasChildren,i.ChildrenCount=o.ExtendObject.ChildrenCount),e||(i.checked=!0),o.children){var s=$.MvcSheetUI.sheetUserParams.loadOptions.split("=");s=2==s.length?s[1].toLowerCase():"";var c=[],l=[],d=[];o.children.forEach(function(e,t){switch(e.ExtendObject.UnitType.toLowerCase()){case"u":(a=new r.sheetUser).id=e.ObjectID,a.name=e.Text,a.Icon="task-sort-icon fa  fa-user",d.push(a);break;case"o":if((n=r.sheetOrgAdapter(e,o.Code,r)).Icon="task-sort-icon fa icon-zuzhitubiao",i.children.push(n),-1<s.indexOf("o"))(a=new r.sheetUser).id=e.ObjectID,a.name=e.Text,a.Icon="task-sort-icon fa icon-zuzhitubiao",c.push(a);break;case"g":var n,a;if((n=r.sheetOrgAdapter(e,o.Code,r)).Icon="task-sort-icon fa  fa fa-users",i.children.push(n),-1<s.indexOf("g"))(a=new r.sheetUser).id=e.ObjectID,a.name=e.Text,a.Icon="task-sort-icon fa  fa fa-users",l.push(a)}}),(0<c.length||0<c.length||0<c.length)&&(i.users||(i.users=[]),i.users=i.users.concat(c),i.users=i.users.concat(l),i.users=i.users.concat(d))}return i},sheetUserAdapter:function(e,a){a=a||"";var t=[],o=this;if(!e||0===e.length)return t;var r=[],i=[],s=[];return e.forEach(function(e,t){var n=new o.sheetUser;n.id=e.ObjectID,n.code=e.Code,n.name=e.Text,n.fullname=n.name+" ["+n.code+"]",n.Icon=e.Icon,n.canSelect=!1,e.ExtendObject&&(n.ChildrenCount=e.ExtendObject.ChildrenCount,n.DepartmentName=e.ExtendObject.DepartmentName,n.UserGender=e.ExtendObject.UserGender,n.UserImageUrl=e.ExtendObject.UserImageUrl),-1<e.Icon.indexOf("icon-zuzhitubiao")?(n.type="O",r.push(n)):-1<e.Icon.indexOf("fa-users")?(n.type="G",i.push(n)):(n.type="U",s.push(n)),-1<a.indexOf(n.type)&&(n.canSelect=!0)}),t=(t=(t=t.concat(r)).concat(i)).concat(s)},decrypt:function(e){var t;return $.ajax({url:"AES/decrypt",data:{original:e},async:!1,method:"post",success:function(e){t=e}}),t},convertItems:function(e){if(!e)return[];if(1==e.length)return{Code:e[0].id,Name:e[0].name,ContentType:e[0].type,UserGender:e[0].UserGender,UserImageUrl:e[0].UserImageUrl};var n=[];return e.forEach(function(e,t){n.push({Code:e.id,Name:e.name,ContentType:e.type,UserGender:e.UserGender,UserImageUrl:e.UserImageUrl})}),n}}});