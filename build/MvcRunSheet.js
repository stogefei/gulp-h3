var _Sheet_Computation_GlobalString={Sheet_Computation_Msg0:"计算规则设置错误："},CompuationFun=[{Name:"",Accept:function(t){return-1==t.indexOf("(")},Compuator:function(t,e,i){var a=t.sheet.getDataFieldValue(e,i);return a?a.replace(/,/g,"").replace(/$/g,"").replace(/¥/g,""):0},Field:function(t){return t},IsFunc:!0},{Name:"SUM",Accept:function(t){return 0==t.toLocaleLowerCase().indexOf("sum(")},Compuator:function(t,e,i,a){var n=this.Field(i);i=this.Express(i);var r=0;return $("input[data-datafield='"+n+"'],span[data-datafield='"+n+"']").each(function(t,e,i){var a=0;a=e?t.executeCompute(this.id,i,e):"input"==this.tagName.toLocaleLowerCase()||"select"==this.tagName.toLocaleLowerCase()?this.value:this.innerText,$(this).attr("data-formatrule")&&(a=a.replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")),a&&!isNaN(a)&&(r+=parseFloat(a))},[t,i,a]),r},Field:function(t){var e=t.substring(t.indexOf("{")+1);return e=e.substring(0,e.indexOf("}"))},Express:function(t){if(-1==t.indexOf(","))return"";var e=t.substring(t.indexOf(",")+1);return e.substring(0,e.length-1)},IsFunc:!0},{Name:"AVG",Accept:function(t){return 0==t.toLocaleLowerCase().indexOf("avg(")},Compuator:function(t,e,i,a){var n=this.Field(i);i=this.Express(i);var r=0,s=$("input[data-datafield='"+n+"'],span[data-datafield='"+n+"']");return $("input[data-datafield='"+n+"'],span[data-datafield='"+n+"']").each(function(t,e,i){var a=0;a=e?t.executeCompute(this.id,i,e):"input"==this.tagName.toLocaleLowerCase()||"select"==this.tagName.toLocaleLowerCase()?this.value:this.innerText,$(this).attr("data-formatrule")&&(a=a.replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")),a&&!isNaN(a)&&(r+=parseFloat(a))},[t,i,a]),parseFloat(r/s.length)},Field:function(t){var e=t.substring(t.indexOf("{")+1);return e=e.substring(0,e.indexOf("}"))},Express:function(t){if(-1==t.indexOf(","))return"";var e=t.substring(t.indexOf(",")+1);return e.substring(0,e.length-1)},IsFunc:!0},{Name:"COUNT",Accept:function(t){return 0==t.toLocaleLowerCase().indexOf("count(")},Compuator:function(t,e,i,a){var n=this.Field(i);return $("input[data-datafield='"+n+"'],span[data-datafield='"+n+"']").length},Field:function(t){var e=t.substring(t.indexOf("{")+1);return e=e.substring(0,e.indexOf("}"))},Express:function(t){if(-1==t.indexOf(","))return"";var e=t.substring(t.indexOf(",")+1);return e.substring(0,e.length-1)},IsFunc:!0},{Name:"MAX",Accept:function(t){return 0==t.toLocaleLowerCase().indexOf("max(")},Compuator:function(t,e,i,a){var n=this.Field(i);i=this.Express(i);var r=0;return $("input[data-datafield='"+n+"'],span[data-datafield='"+n+"']").each(function(t,e,i){var a=0;if(a=e?t.executeCompute(this.id,i,e):"input"==this.tagName.toLocaleLowerCase()||"select"==this.tagName.toLocaleLowerCase()?this.value:this.innerText,$(this).attr("data-formatrule")&&(a=a.replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")),a&&!isNaN(a)){var n=parseFloat(a);r<n&&(r=n)}},[t,i,a]),r},Field:function(t){var e=t.substring(t.indexOf("{")+1);return e=e.substring(0,e.indexOf("}"))},Express:function(t){if(-1==t.indexOf(","))return"";var e=t.substring(t.indexOf(",")+1);return e.substring(0,e.length-1)},IsFunc:!0},{Name:"MIN",Accept:function(t){return 0==t.toLocaleLowerCase().indexOf("min(")},Compuator:function(t,e,i,a){var r,n=this.Field(i);return i=this.Express(i),$("input[data-datafield='"+n+"'],span[data-datafield='"+n+"']").each(function(t,e,i){var a=0;if(a=e?t.executeCompute(this.id,i,e):"input"==this.tagName.toLocaleLowerCase()||"select"==this.tagName.toLocaleLowerCase()?this.value:this.innerText,$(this).attr("data-formatrule")&&(a=a.replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")),a&&!isNaN(a)){var n=parseFloat(a);null==r?r=n:n<r&&(r=n)}},[t,i,a]),r},Field:function(t){var e=t.substring(t.indexOf("{")+1);return e=e.substring(0,e.indexOf("}"))},Express:function(t){if(-1==t.indexOf(","))return"";var e=t.substring(t.indexOf(",")+1);return e.substring(0,e.length-1)},IsFunc:!0}];Sheet.Computation=function(t){this.RegisterEventRules=[],this.RegisterEventOnLoad=[],this.sheet=t,this.operators="+-*/()",this.AttrDataField="data-datafield",this.AttrName="data-computationrule",this.init(this)},Sheet.Computation.prototype={init:function(n){this.RegisterEventRules=[],this.RegisterEventOnLoad=[],this.sheet.container?this.sheet.container=$(this.sheet.container.context).find(":input["+this.AttrName+"],span["+this.AttrName+"],textarea["+this.AttrName+"]"):this.sheet.container=$(":input["+this.AttrName+"],span["+this.AttrName+"],textarea["+this.AttrName+"]"),this.sheet.container.each(function(t){var e,i,a=$.trim($(this).attr(t.AttrName));a&&(i=1==a.indexOf(",")?(e=n.getRoundFromCompute(a),n.getExpressFromCompute(a)):(e=0,a),n.registerEvent(n,this.id,e,i,i),this.onkeydown=function(){return!1},this.onpasete=function(){return!1})},[this])},registerEvent:function(t,e,i,a,n){for(var r=a.split("{"),s=[],o=1;o<r.length;o++){var h=r[o].indexOf("}");if(-1==h)return void alert(_Sheet_Computation_GlobalString.Sheet_Computation_Msg0+a);for(var l=r[o].substring(0,h),d=0;d<t.RegisterEventRules.length;d++)if(t.RegisterEventRules[d].Express==n&&t.RegisterEventRules[d].ID==e&&t.RegisterEventRules[d].dataField&&0!=t.RegisterEventRules[d].dataField.length)for(var u=0;u<t.RegisterEventRules[d].dataField.length;u++)if(t.RegisterEventRules[d].dataField[u]==l)return;if(!l)return void alert(_Sheet_Computation_GlobalString.Sheet_Computation_Msg0+l);if(s.push(l),-1<a.indexOf(",")){var c=a.substring(a.indexOf(","));-1<c.indexOf("{")&&-1<c.indexOf("}")&&(c=(c=c.split("{")[1]).substring(0,c.indexOf("}")));var p=$("input["+this.AttrDataField+"='"+l+"'],span["+this.AttrDataField+"='"+l+"'],select["+this.AttrDataField+"='"+l+"'],input["+this.AttrDataField+"='"+c+"'],select["+this.AttrDataField+"='"+c+"']")}else p=$("input["+this.AttrDataField+"='"+l+"'],span["+this.AttrDataField+"='"+l+"'],textarea["+this.AttrDataField+"='"+l+"']");p&&(p.each(function(){t.registerControlEvent(t,e,i,$(this),n)}),t.registerOnLoadEvent(t,e,i,n))}t.RegisterEventRules.push({ID:e,Express:n,dataField:s})},registerControlEvent:function(t,e,i,a,n){var r=a.attr(t.AttrName);if(r){var s=t.getExpressFromCompute(r),o=t.getRoundFromCompute(r);t.registerOnLoadEvent(t,a[0].id,o,s),$("input["+t.AttrName+"='"+r+"']").each(function(){t.registerEvent(t,this.id,o,s,s)}),t.registerEvent(t,e,i,s,n)}else a.change(function(){0<$("#"+e).length&&t.computator(e,i,n)})},registerOnLoadEvent:function(t,e,i,a){for(var n=0;n<t.RegisterEventOnLoad.length;n++)if(t.RegisterEventOnLoad[n]==e)return;$(function(){t.computator(e,i,a)}),t.RegisterEventOnLoad.push(e)},getRoundFromCompute:function(t){return-1==t.indexOf(",")?2:parseInt(t.substring(0,t.indexOf(",")))},getExpressFromCompute:function(t){return-1==t.indexOf(",")?t:t.substring(t.indexOf(",")+1)},executeCompute:function(t,e,i){for(var a="";0<i.length;){var n="";if("{"==(h=i[0])){var r=i.substring(1,i.indexOf("}"));a=a+"("+this.CheckIsDateAndGetDays(CompuationFun[0].Compuator(this,$("#"+t),r,e))+")",i=i.substring(i.indexOf("}")+1)}else if(-1<this.operators.indexOf(h))i=i.substring(1),a+=h;else if(0==i.toLocaleLowerCase().indexOf("sum")||0==i.toLocaleLowerCase().indexOf("avg")||0==i.toLocaleLowerCase().indexOf("count")||0==i.toLocaleLowerCase().indexOf("min")||0==i.toLocaleLowerCase().indexOf("max")){for(var s=0,o=["("],h=i.indexOf("(")+1;h<i.length;h++)if("("==i[h]&&o.push("("),")"==i[h]&&o.pop(),0==o.length){s=h;break}n=i.substring(0,s+1),i=i.substring(s+1);for(var l=0;l<CompuationFun.length;l++)if(CompuationFun[l].Accept(n)){a+=this.CheckIsDateAndGetDays(CompuationFun[l].Compuator(this,$("#"+t),n,e));break}}else a+=h,i=i.substring(1)}return this.sheet.getResultValue(a)},computator:function(t,e,i){var a=this.executeCompute(t,e,i);if(isFinite(a)){if(a=this.toFixed(a,e),(n=$("#"+t)).is("input,textarea"))n.val().replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")!=a&&(n.val(a),n.trigger("change"),n.blur());else if(n.is("div,span")){n.html().replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")!=a&&(n.html(a),n.trigger("change"),n.blur())}}else if(a&&-1<a.indexOf("$Date")){var n,r=a.substring(0,a.length-5);if(isFinite(r))if((n=$("#"+t)).is("input,textarea"))n.val().replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")!=r&&(n.val(r),n.trigger("change"),n.blur());else if(n.is("div,span")){n.html().replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")!=r&&(n.html(r),n.trigger("change"),n.blur())}}},toFixed:function(t,e){if(0==t||!t)return t;var i,a=(i=t<0?parseInt(t*Math.pow(10,e)-.5)/Math.pow(10,e):parseInt(t*Math.pow(10,e)+.5)/Math.pow(10,e)).toString().indexOf(".");if(a<0&&0<e){i+=".";for(var n=0;n<e;n++)i+="0"}else{a=i.toString().length-a;for(n=0;n<e-a+1;n++)i+="0"}return i},CheckIsDateAndGetDays:function(t){return null==String(t).match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/)?t:new Date(t).getTime()/864e5}};var _v="",_Sheet_Display_GlobalString={Sheet_Display_Msg0:"显示规则设置错误："};Sheet.Display=function(t){this.AttrName="data-displayrule",this.sheet=t,this.controls=[],this.init()},Sheet.Display.prototype={init:function(){this.controls.length=0,this.sheet.container?this.sheet.container=$(this.sheet.container.context).find("input["+this.AttrName+"],span["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],label["+this.AttrName+"]"):this.sheet.container=$("input["+this.AttrName+"],span["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],label["+this.AttrName+"]"),this.sheet.container.each(function(t){if(!$(this).parent().parent().hasClass("template")){var e=$(this).attr(t.AttrName);e&&t.registerEvent(this.id,e)}},[this]),$.each(this.controls,function(t,e){$(e).change()})},registerEvent:function(i,a){for(var t,e=a.split("{"),n=1;n<e.length;n++){var r=e[n].indexOf("}");if(-1==r)return void alert(_Sheet_Display_GlobalString.Sheet_Display_Msg0+a);t=e[n].substring(0,r);var s=this.sheet.findControlByDataField($("#"+i),t);if(!s)return;s.unbind("change."+i).bind("change."+i,[this],function(t,e){0!=$("#"+i).length&&(_v=e,t.data[0].selectChanged($("#"+i),a))}),this.controls.push(s)}},contains:function(i){var a=!1;return $.each(this.controls,function(t,e){$(e).attr("data-datafield")==i&&(a=!0)}),a},setDisplay:function(t,e){e?(t.removeClass("hidden"),0<t.next().length&&t.next().attr("for")&&t.next().attr("for")==t.attr("id")&&t.next().removeClass("hidden")):(t.addClass("hidden"),0<t.next().length&&t.next().attr("for")&&t.next().attr("for")==t.attr("id")&&t.next().addClass("hidden"))},selectChanged:function(t,e){for(var i,a=e.split("{"),n=a[0],r=1;r<a.length;r++){var s=a[r].indexOf("}");if(-1==s)return void alert(_Sheet_Display_GlobalString.Sheet_Display_Msg0+e);i=a[r].substring(0,s),_v?n="'"+_v+"'":n+="'"+this.sheet.getDataFieldValue(t,i)+"'",n+=a[r].substring(s+1)}var o=this.sheet.getResultValue(n),h="",l=new RegExp("(^|&)IsMobile=([^&]*)(&|$)"),d=top.window.location.search.substr(1).match(l);if(null!=d&&(h=unescape(d[2])),h)if(o){(c=t.parent().parent()).is("tr")&&this.setDisplay(c,!0);var u=!1;"SheetDropDownList"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?u=!0:"Work"==$.MvcSheetUI.QueryString("Mode")?t.next().is("label")&&(u=!0):this.setDisplay(t.parent().find(".select2-container"),!0)),"SheetTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?u=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&t.next().is("label")&&(u=!0)),"SheetRichTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?u=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&0<t.parent().find("div.SheetRichTextBox").length&&(u=!0)),u||this.setDisplay(t.parent(),!0)}else{"SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(t.parent(),!1);var c=t.parent().parent(),p=!1;c.find("label,span,input,select,textarea").each(function(){"none"!=this.style.display&&(p=!0)}),p||("SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(c.parent(),!1))}else if(o){(c=t.parent().parent()).is("tr")&&this.setDisplay(c,!0);u=!1;"SheetDropDownList"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?u=!0:"Work"==$.MvcSheetUI.QueryString("Mode")?t.next().is("label")&&(u=!0):this.setDisplay(t.parent().find(".select2-container"),!0)),"SheetTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?u=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&t.next().is("label")&&(u=!0)),"SheetRichTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?u=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&0<t.parent().find("div.SheetRichTextBox").length&&(u=!0)),u||this.setDisplay(t,!0)}else{"SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(t,!1);c=t.parent().parent(),p=!1;c.find("label,span,input,select,textarea").each(function(){"none"!=this.style.display&&(p=!0)}),p||("SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(c,!1))}}};var NTKO_AttachInfo=new Array,NTKO_AttachObj=new Array,_Sheet_GlobalString={Sheet_Loading:"数据加载中……",Sheet_Wait:"系统正在处理{0}操作,请稍候。。。",Sheet_Search:"搜索：",Sheet_Close:"关闭",Sheet_More:"更多..."},pageInfo={LockImage:'<%=ResolveUrl("~/WFRes/images/WaitProcess.gif")%>'},Sheet=function(t){this.autoHiddenEmptyRow=!1,this.AttrDatafield="data-datafield",this.init(t)};Sheet.prototype={init:function(t){this.container=t,this.Computation=new Sheet.Computation(this),this.Validate=new Sheet.Validate(this),this.Display=new Sheet.Display(this),this.autoFinishWorkItem(),this.autoHiddenEmptyRow&&this.hiddenEmptyRow()},getResultValue:function(express){if(-1!=express.indexOf("return"))return new Function(express).call(this);try{if(express){var array=express.split(")-(");if(2!=array.length)return eval(express);var index1=array[0].lastIndexOf("("),index2=array[1].lastIndexOf(")");if(-1==index1||-1==index2)return eval(express);var timeStr1=array[0].substring(index1+1),timeStr2=array[1].substring(0,index2);if(timeStr1.length!=timeStr2.length)return eval(express);var reg1=/^(([1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(\s+(20|21|22|23|[0-1]\d):[0-5]\d(:[0-5]\d)*)*)|(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d)$/,regExp1=new RegExp(reg1);if(!regExp1.test(timeStr1)||!regExp1.test(timeStr2))return eval(express);var reg2=/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/,regExp2=new RegExp(reg2);regExp2.test(timeStr1)&&regExp2.test(timeStr2)&&(timeStr1="1999-01-01 "+timeStr1,timeStr2="1999-01-01 "+timeStr2);var time1=new Date(timeStr1).getTime(),time2=new Date(timeStr2).getTime(),days=Number((time1-time2)/864e5);if(-1<(days+"").indexOf(".")&&(days=days.toFixed(1)),days<0)return"";var prefix="";0!=index1&&(prefix=express.substring(0,index1));var suffix="";index2!=array[1].length-1&&(suffix=express.substring(array[0].length+index2+4));var days2=prefix+days+suffix;return days==days2?days+"$Date":eval(days2)+"$Date"}}catch(t){console.log(t)}},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null},isIE:function(){return!!window.ActiveXObject||"ActiveXObject"in window},preview:function(){document.write('<object id="WebBrowser" classid="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2" height="0" width="0"></object>'),document.all.WebBrowser.ExecWB(7,1)},autoFinishWorkItem:function(){var t=this.getQueryString("ParmAction");if("Submit"==t){var e=$("#divTopBars a:contains('提交')");if(0==e.length&&(e=$("#divTopBars a:contains('通过')")),0==e.length&&(e=$("#divTopBars a:contains('已阅')")),0<e.length){var i=e[0].id;__doPostBack(i,"")}}else if("Return"==t){var a=$("#divTopBars a:contains('驳回')");if(0==a.length&&(a=$("#divTopBars a:contains('退回')")),0<a.length){var n=a[0].id;__doPostBack(n,"")}}},hiddenEmptyRow:function(){$("#tbTable tr,#tbBasicInfo tr").each(function(t){2<t&&0<$(this).find("table[id^='tbComment']").length&&""==$.trim($(this).find("table[id^='tbComment']").text())&&0==$(this).find("select").length&&2==$(this).find("td").length&&$(this).hide()})},unLockScreen:function(){$("#divLock").remove(),$("#frameLock").remove()},lockScreen:function(t){var e,i,a;e=$(document).width(),i=$(document).height(),a=$(document).scrollTop()+$(window).height()/2,$("<iframe></iframe>").attr("id","frameLock").css("position","absolute").css("top",0).css("left",0).css("width",e).css("height",i).css("zIndex",9999).css("backgroundColor","Transparent").css("frameborder",0).css("filter","Alpha(Opacity=0)").css("allowtransparency",!0).appendTo("body"),$("<div></div>").html('<table id="spanLockMessage" border="0" style="width:'+e+"px;font-size:26px;font-weight:bold;position:absolute;top:"+a+'px"><tr><td align="center"><img src="'+pageInfo.LockImage+'"></td></tr></table>').attr("id","divLock").css("position","absolute").css("top",0).css("left",0).css("width",e).css("height",i).css("zIndex",1e4).css("backgroundColor","#CCCCCC").css("filter","progid:DXImageTransform.Microsoft.Alpha(style=3,opacity=25,finishOpacity=55").css("opacity","0.6").css("allowtransparency",!0).appendTo("body"),$(window).scroll(function(){$("#spanLockMessage").css("top",$(document).scrollTop()+$(window).height()/2)})},getControlValue:function(t){var e=document.getElementById(t);return null!=e&&null!=e.type?$(e).val():0<$("input[name='"+t+"']").length?$("input[name='"+t+"']:checked").val():""},setControlReadOnly:function(t){var e=this.findControlByDataField(window,t);0<e.length&&e.keydown(function(t){return!1})},findControlByDataField:function(t,e){var i=t.find("select["+this.AttrDatafield+"='"+e+"'],div["+this.AttrDatafield+"='"+e+"'],input["+this.AttrDatafield+"='"+e+"'],span["+this.AttrDatafield+"='"+e+"'],table["+this.AttrDatafield+"='"+e+"'],textarea["+this.AttrDatafield+"='"+e+"']");if(0<i.length)for(var a=0;a<i.length;a++){var n=$(i[a]);if(!n.is("span"))return n.is("div")?n.find("input"):n;if(0<n.find("input").length)return n.find("input");if(n.attr("data-type")&&"SheetLabel"==n.attr("data-type")&&n.attr("data-bindtype")&&"OnlyData"==n.attr("data-bindtype"))return n}return(t=t.parent()).is("body")?null:this.findControlByDataField(t,e)},getDataFieldValue:function(t,e){var i=t.find("input["+this.AttrDatafield+"='"+e+"'],select["+this.AttrDatafield+"='"+e+"'],textarea["+this.AttrDatafield+"='"+e+"']");if(0<i.length){var a=i.next();if(0<a.length&&a.is("label")&&a.attr("for")==i.attr("id")){if(i.is("select")){var n=a.text(),r="";return i.find("option").each(function(){if($(this).text()==n)return r=$(this).val(),!1}),r}if(i.is("input"))return a.find("span").eq(0).text()}else if(0<a.length&&a.is("label")&&i.is("input")&&0==a.find("span").length)return a.text();return i.val()}if(0<(i=t.find("span["+this.AttrDatafield+"='"+e+"']")).length){if(0<i.find("input").length)return i.find("input").is(":checked");if(0<i.find("input").length)return i.find("input").is(":checked");if(i.attr("data-type")&&"SheetLabel"==i.attr("data-type")&&i.attr("data-bindtype")&&"OnlyData"==i.attr("data-bindtype"))return i.html()}if(0<(i=t.find("table["+this.AttrDatafield+"='"+e+"']")).length){for(var s=i.find("input"),o=0;o<s.length;o++)if(s[o].checked)return s[o].value;return""}if(0<(i=t.find("div["+this.AttrDatafield+"='"+e+"']")).length){for(s=i.find("input"),o=0;o<s.length;o++)if(s[o].checked)return s[o].value;return""}return(t=t.parent()).is("body")||t.is("html")?null:this.getDataFieldValue(t,e)},getDataFieldControlValue:function(t,e){var i=t.find("input["+this.AttrDatafield+"='"+e+"'],textarea["+this.AttrDatafield+"='"+e+"'],select["+this.AttrDatafield+"='"+e+"']");return 0<i.length?i.val():0<(i=t.find("span["+this.AttrDatafield+"='"+e+"']")).length?i.html():(t=t.parent()).is("body")||t.is("html")?null:this.getDataFieldValue(t,e)},setDataFieldControlValue:function(t,e,i){var a=t.find("input["+this.AttrDatafield+"='"+e+"'],textarea["+this.AttrDatafield+"='"+e+"']");if(0<a.length)a.val(i);else if(0<(a=t.find("span["+this.AttrDatafield+"='"+e+"']")).length)a.html(i);else if(!(t=t.parent()).is("body")&&!t.is("html"))return this.setDataFieldControlValue(t,e,i)},executeService:function(t,e,i,a,n){var r,s=this.executeBizService(t,e,i,a);if(n)r=s[n];else for(var o in s){r=s[o];break}return r},executeBizService:function(t,e,i,a){var n,r={cmd:"ExecuteServiceMethod",ServiceCode:t,MethodName:e};if(a=a||$("body"),i){for(var s in i)r[s]=this.getDataFieldControlValue(a,i[s]),r[s]||(r[s]=i[s]);for(var s in i)r[s]||(r[i[s]]=this.getDataFieldControlValue(a,s))}return $.ajax({type:"POST",async:!1,url:_PORTALROOT_GLOBAL+"/AjaxServices/executeServiceMethod",data:r,dataType:"json",success:function(t){n=t},error:function(t){var e=t.toString();alert(e)}}),n}};var winPrint=function(){window.print()};function isBrowseIPad(){return"ipad"==navigator.userAgent.toLowerCase().match(/iPad/i)}Sheet.Validate=function(t){this.requiredValue="data-requiredfield",this.AttrName="data-vaildationrule",this.sheet=t,this.controls=[],this.init()},Sheet.Validate.prototype={init:function(){this.controls.length=0,this.sheet.container?this.sheet.container=$(this.sheet.container.context).find("input["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],span["+this.AttrName+"]"):this.sheet.container=$("input["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],span["+this.AttrName+"]"),this.sheet.container.each(function(t){if(!(0<$(this).closest("tr").length&&$(this).closest("tr").hasClass("template"))){var e=$(this).attr(t.AttrName);e&&t.registerEvent(this.id,e)}},[this]),$.each(this.controls,function(t,e){$(e).change()})},registerEvent:function(e,i){for(var t,a=i.split("{"),n=1;n<a.length;n++){var r=a[n].indexOf("}");if(-1==r)return void alert(_Sheet_Validate_GlobalString.Sheet_Validate_Msg0+i);t=a[n].substring(0,r);var s=this.sheet.findControlByDataField($("#"+e),t);if(!s)return;s.unbind("change.Validate"+e).bind("change.Validate"+e,[this],function(t){0!=$("#"+e).length&&t.data[0].selectChanged($("#"+e),i)}),this.contains(t)||this.controls.push(s)}},contains:function(i){var a=!1;return $.each(this.controls,function(t,e){$(e).attr("data-datafield")==i&&(a=!0)}),a},selectChanged:function(t,e){for(var i,a=e.split("{"),n=a[0],r=1;r<a.length;r++){var s=a[r].indexOf("}");if(-1==s)return void alert(_Sheet_Validate_GlobalString.Sheet_Validate_Msg0+e);i=a[r].substring(0,s),n+="'"+this.sheet.getDataFieldValue(t,i)+"'",n+=a[r].substring(s+1)}var o=this.sheet.getResultValue(n),h=t.attr("data-type"),l=(h=t.attr("data-type"),""),d=new RegExp("(^|&)IsMobile=([^&]*)(&|$)"),u=top.window.location.search.substr(1).match(d);if(null!=u&&(l=unescape(u[2])),l){h=t.attr("data-type");if(o)if("SheetDropDownList"==h||"SheetCheckboxList"==h||"SheetRadioButtonList"==h||"SheetTextBox"==h||"SheetRichTextBox"==h){var c=null;switch(h){case"SheetDropDownList":c=$(t).SheetDropDownList();break;case"SheetCheckboxList":c=$(t).SheetCheckboxList();break;case"SheetRadioButtonList":c=$(t).SheetRadioButtonList();break;case"SheetTextBox":c=$(t).SheetTextBox(),t.attr("data-Required",!0);break;case"SheetRichTextBox":c=$(t).SheetRichTextBox()}c.Required=!0,c.Validate()}else t.parent().attr("data-Required",!0);else if("SheetDropDownList"==h||"SheetCheckboxList"==h||"SheetRadioButtonList"==h||"SheetTextBox"==h||"SheetRichTextBox"==h){c=null;switch(h){case"SheetDropDownList":c=$(t).SheetDropDownList();break;case"SheetCheckboxList":c=$(t).SheetCheckboxList();break;case"SheetRadioButtonList":c=$(t).SheetRadioButtonList();break;case"SheetTextBox":c=$(t).SheetTextBox(),t.removeAttr("data-Required");break;case"SheetRichTextBox":c=$(t).SheetRichTextBox()}c.Required=!1,c.RemoveInvalidText(c.Element)}else{t.parent().removeAttr("data-Required"),t.parent().removeClass($.MvcSheetUI.Css.inputError),(p=t.parent().next()).hasClass("InvalidText")&&p.remove()}}else if(o)if("SheetDropDownList"==h||"SheetCheckboxList"==h||"SheetRadioButtonList"==h){c=null;switch(h){case"SheetDropDownList":c=$(t).SheetDropDownList();break;case"SheetCheckboxList":c=$(t).SheetCheckboxList();break;case"SheetRadioButtonList":c=$(t).SheetRadioButtonList()}c.Required=!0,c.Validate()}else{t.attr("data-Required",!0),(c=$(t).SheetUIManager())&&(c.Required=!0)}else if("SheetDropDownList"==h||"SheetCheckboxList"==h||"SheetRadioButtonList"==h){c=null;switch(h){case"SheetDropDownList":c=$(t).SheetDropDownList();break;case"SheetCheckboxList":c=$(t).SheetCheckboxList();break;case"SheetRadioButtonList":c=$(t).SheetRadioButtonList()}c.Required=!1,c.RemoveInvalidText(c.Element)}else{var p;t.removeAttr("data-Required"),t.removeClass($.MvcSheetUI.Css.inputError),(p=t.next()).hasClass("InvalidText")&&p.remove(),(c=$(t).SheetUIManager())&&(c.Required=!1)}t.trigger("change")}};